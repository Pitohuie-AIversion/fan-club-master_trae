<svg width="600" height="400" viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="rgba(0,0,0,0.3)"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="600" height="400" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="300" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2c3e50">Fan Club MkIV 系统架构</text>
  
  <!-- Hardware Layer -->
  <rect x="50" y="60" width="500" height="80" rx="10" fill="url(#grad1)" filter="url(#shadow)"/>
  <text x="300" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">硬件层 (Hardware Layer)</text>
  
  <!-- STM32 -->
  <rect x="80" y="100" width="120" height="30" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="140" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">STM32F429ZI</text>
  
  <!-- PWM -->
  <rect x="220" y="100" width="80" height="30" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="260" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">PWM输出</text>
  
  <!-- UART -->
  <rect x="320" y="100" width="80" height="30" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="360" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">UART通信</text>
  
  <!-- Fan Motor -->
  <rect x="420" y="100" width="100" height="30" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="470" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">风扇电机</text>
  
  <!-- OS Layer -->
  <rect x="50" y="160" width="500" height="60" rx="10" fill="url(#grad2)" filter="url(#shadow)"/>
  <text x="300" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">操作系统层 (OS Layer)</text>
  
  <!-- Mbed OS -->
  <rect x="250" y="190" width="100" height="25" rx="5" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
  <text x="300" y="207" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">Mbed OS RTOS</text>
  
  <!-- Application Layer -->
  <rect x="50" y="240" width="500" height="100" rx="10" fill="url(#grad3)" filter="url(#shadow)"/>
  <text x="300" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">应用层 (Application Layer)</text>
  
  <!-- Fan Class -->
  <rect x="80" y="275" width="100" height="50" rx="5" fill="rgba(255,255,255,0.9)" stroke="#4facfe" stroke-width="2"/>
  <text x="130" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2c3e50">Fan类</text>
  <text x="130" y="308" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">风扇控制</text>
  <text x="130" y="318" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">速度管理</text>
  
  <!-- Communicator Class -->
  <rect x="200" y="275" width="100" height="50" rx="5" fill="rgba(255,255,255,0.9)" stroke="#4facfe" stroke-width="2"/>
  <text x="250" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2c3e50">Communicator类</text>
  <text x="250" y="308" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">串口通信</text>
  <text x="250" y="318" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">消息处理</text>
  
  <!-- Processor Class -->
  <rect x="320" y="275" width="100" height="50" rx="5" fill="rgba(255,255,255,0.9)" stroke="#4facfe" stroke-width="2"/>
  <text x="370" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2c3e50">Processor类</text>
  <text x="370" y="308" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">数据处理</text>
  <text x="370" y="318" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">算法控制</text>
  
  <!-- FastPWM Library -->
  <rect x="440" y="275" width="100" height="50" rx="5" fill="rgba(255,255,255,0.9)" stroke="#4facfe" stroke-width="2"/>
  <text x="490" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2c3e50">FastPWM库</text>
  <text x="490" y="308" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">高精度PWM</text>
  <text x="490" y="318" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">信号生成</text>
  
  <!-- Arrows -->
  <!-- Hardware to OS -->
  <path d="M 300 140 L 300 160" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- OS to Application -->
  <path d="M 300 220 L 300 240" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Inter-component arrows -->
  <path d="M 180 300 L 200 300" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 300 300 L 320 300" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 420 300 L 440 300" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Application to Hardware feedback -->
  <path d="M 130 275 Q 50 250 50 200 Q 50 150 80 115" stroke="#28a745" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50"/>
    </marker>
  </defs>
  
  <!-- Data Flow Labels -->
  <text x="310" y="155" font-family="Arial, sans-serif" font-size="10" fill="#666">硬件抽象</text>
  <text x="310" y="235" font-family="Arial, sans-serif" font-size="10" fill="#666">系统调用</text>
  
  <!-- Legend -->
  <rect x="450" y="350" width="140" height="40" rx="5" fill="white" stroke="#ddd" stroke-width="1"/>
  <text x="520" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#2c3e50">数据流向</text>
  <line x1="460" y1="375" x2="480" y2="375" stroke="#2c3e50" stroke-width="2"/>
  <text x="485" y="378" font-family="Arial, sans-serif" font-size="9" fill="#666">控制流</text>
  <line x1="520" y1="375" x2="540" y2="375" stroke="#28a745" stroke-width="2" stroke-dasharray="3,3"/>
  <text x="545" y="378" font-family="Arial, sans-serif" font-size="9" fill="#666">反馈</text>
</svg>