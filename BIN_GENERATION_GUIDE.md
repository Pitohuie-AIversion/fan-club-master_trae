# Fan Club MkIV é¡¹ç›® - BIN æ–‡ä»¶ç”ŸæˆæŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜Žå¦‚ä½•ä¸º Fan Club MkIV é¡¹ç›®ç”Ÿæˆ `.bin` å›ºä»¶æ–‡ä»¶ã€‚

## æ¦‚è¿°

`.bin` æ–‡ä»¶æ˜¯ç¼–è¯‘åŽçš„äºŒè¿›åˆ¶å›ºä»¶æ–‡ä»¶ï¼Œå¯ä»¥ç›´æŽ¥åˆ·å†™åˆ°å¾®æŽ§åˆ¶å™¨ä¸­ã€‚Fan Club MkIV é¡¹ç›®åŒ…å«ä¸¤ä¸ªä¸»è¦çš„å›ºä»¶ç»„ä»¶ï¼š

1. **ä»Žæœºå›ºä»¶** (`slave_upgraded`) - ä¸»è¦æŽ§åˆ¶é€»è¾‘
2. **å¼•å¯¼ç¨‹åºå›ºä»¶** (`slave_bootloader_upgraded`) - å›ºä»¶æ›´æ–°åŠŸèƒ½

## å‰ææ¡ä»¶

âœ… **å·²éªŒè¯çš„çŽ¯å¢ƒçŠ¶æ€**ï¼š
- Mbed Studio å·²å®‰è£…å¹¶é…ç½®
- é¡¹ç›®ç»“æž„å®Œæ•´ (100% å°±ç»ª)
- æ‰€æœ‰ä¾èµ–åº“å·²å°±ä½
- ç¼–è¯‘çŽ¯å¢ƒå·²å‡†å¤‡å°±ç»ª

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Mbed Studioï¼ˆæŽ¨èï¼‰

### æ­¥éª¤ 1ï¼šæ‰“å¼€é¡¹ç›®

1. å¯åŠ¨ **Mbed Studio**
2. é€‰æ‹© `File` â†’ `Open Workspace`
3. å¯¼èˆªåˆ°é¡¹ç›®ç›®å½•ï¼š
   ```
   d:\2025\chendashuai_wind_turnnal\fan-club-master\fan-club-master_trae
   ```

### æ­¥éª¤ 2ï¼šç¼–è¯‘ä»Žæœºå›ºä»¶

1. åœ¨é¡¹ç›®æµè§ˆå™¨ä¸­é€‰æ‹© `slave_upgraded` æ–‡ä»¶å¤¹
2. å³é”®ç‚¹å‡» â†’ `Set as Active Program`
3. ç¡®è®¤ç›®æ ‡ç¡¬ä»¶ï¼š`NUCLEO_F446RE`
4. ç‚¹å‡» **Build** æŒ‰é’® (ðŸ”¨) æˆ–æŒ‰ `Ctrl+B`
5. ç­‰å¾…ç¼–è¯‘å®Œæˆ

**ç¼–è¯‘è¾“å‡ºä½ç½®**ï¼š
```
slave_upgraded\BUILD\NUCLEO_F446RE\ARMC6\slave_upgraded.bin
```

### æ­¥éª¤ 3ï¼šç¼–è¯‘å¼•å¯¼ç¨‹åºå›ºä»¶

1. åœ¨é¡¹ç›®æµè§ˆå™¨ä¸­é€‰æ‹© `slave_bootloader_upgraded` æ–‡ä»¶å¤¹
2. å³é”®ç‚¹å‡» â†’ `Set as Active Program`
3. ç¡®è®¤ç›®æ ‡ç¡¬ä»¶ï¼š`NUCLEO_F446RE`
4. ç‚¹å‡» **Build** æŒ‰é’® (ðŸ”¨) æˆ–æŒ‰ `Ctrl+B`
5. ç­‰å¾…ç¼–è¯‘å®Œæˆ

**ç¼–è¯‘è¾“å‡ºä½ç½®**ï¼š
```
slave_bootloader_upgraded\BUILD\NUCLEO_F446RE\ARMC6\slave_bootloader_upgraded.bin
```

## æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œç¼–è¯‘

### å‰ææ¡ä»¶
- å®‰è£… Mbed CLI 2
- é…ç½® ARM Compiler 6

### ç¼–è¯‘å‘½ä»¤

```powershell
# ç¼–è¯‘ä»Žæœºå›ºä»¶
cd slave_upgraded
mbed compile -t ARMC6 -m NUCLEO_F446RE

# ç¼–è¯‘å¼•å¯¼ç¨‹åºå›ºä»¶
cd ..\slave_bootloader_upgraded
mbed compile -t ARMC6 -m NUCLEO_F446RE
```

## ç¼–è¯‘é…ç½®è¯¦æƒ…

### ç›®æ ‡ç¡¬ä»¶
- **å¼€å‘æ¿**: STM32 Nucleo-F446RE
- **å¾®æŽ§åˆ¶å™¨**: STM32F446RET6
- **æž¶æž„**: ARM Cortex-M4
- **é¢‘çŽ‡**: 180 MHz

### ç¼–è¯‘å™¨è®¾ç½®
- **ç¼–è¯‘å™¨**: ARM Compiler 6 (ARMC6)
- **ä¼˜åŒ–çº§åˆ«**: -O2 (å¹³è¡¡æ€§èƒ½å’Œä»£ç å¤§å°)
- **è°ƒè¯•ä¿¡æ¯**: åŒ…å« (-g)

### å†…å­˜é…ç½®
- **Flash**: 512 KB
- **RAM**: 128 KB
- **å¼•å¯¼ç¨‹åºåŒºåŸŸ**: 0x08000000 - 0x08007FFF (32KB)
- **åº”ç”¨ç¨‹åºåŒºåŸŸ**: 0x08008000 - 0x0807FFFF (480KB)

## ç”Ÿæˆçš„æ–‡ä»¶è¯´æ˜Ž

### ä»Žæœºå›ºä»¶ (slave_upgraded.bin)
- **åŠŸèƒ½**: ä¸»è¦æŽ§åˆ¶é€»è¾‘ã€é£Žæ‰‡æŽ§åˆ¶ã€é€šä¿¡å¤„ç†
- **å¤§å°**: çº¦ 200-300 KB
- **åŠ è½½åœ°å€**: 0x08008000 (åº”ç”¨ç¨‹åºåŒºåŸŸ)

### å¼•å¯¼ç¨‹åºå›ºä»¶ (slave_bootloader_upgraded.bin)
- **åŠŸèƒ½**: å›ºä»¶æ›´æ–°ã€ç³»ç»Ÿåˆå§‹åŒ–
- **å¤§å°**: çº¦ 30-50 KB
- **åŠ è½½åœ°å€**: 0x08000000 (å¼•å¯¼ç¨‹åºåŒºåŸŸ)

## éªŒè¯ç¼–è¯‘ç»“æžœ

### æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
```powershell
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls slave_upgraded\BUILD\NUCLEO_F446RE\ARMC6\*.bin
ls slave_bootloader_upgraded\BUILD\NUCLEO_F446RE\ARMC6\*.bin

# æ£€æŸ¥æ–‡ä»¶å¤§å°
Get-ChildItem -Path "*\BUILD\*\*.bin" | Select-Object Name, Length
```

### ç¼–è¯‘æˆåŠŸæ ‡å¿—
- âœ… ç¼–è¯‘è¿‡ç¨‹æ— é”™è¯¯
- âœ… ç”Ÿæˆ `.bin` æ–‡ä»¶
- âœ… æ–‡ä»¶å¤§å°åˆç† (>10KB, <500KB)
- âœ… ç¼–è¯‘æ—¥å¿—æ˜¾ç¤º "Build succeeded"

## éƒ¨ç½²åˆ°ç¡¬ä»¶

### æ–¹æ³• 1ï¼šä½¿ç”¨ Mbed Studio
1. è¿žæŽ¥ NUCLEO-F446RE å¼€å‘æ¿
2. åœ¨ Mbed Studio ä¸­ç‚¹å‡» **Run** æŒ‰é’®
3. å›ºä»¶å°†è‡ªåŠ¨åˆ·å†™åˆ°å¼€å‘æ¿

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨å¤åˆ¶
1. è¿žæŽ¥å¼€å‘æ¿ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸º USB å­˜å‚¨è®¾å¤‡
2. å°† `.bin` æ–‡ä»¶å¤åˆ¶åˆ°å¼€å‘æ¿çš„æ ¹ç›®å½•
3. å¼€å‘æ¿ä¼šè‡ªåŠ¨é‡å¯å¹¶åŠ è½½æ–°å›ºä»¶

### æ–¹æ³• 3ï¼šä½¿ç”¨ ST-Link Utility
1. æ‰“å¼€ STM32 ST-LINK Utility
2. è¿žæŽ¥åˆ°ç›®æ ‡è®¾å¤‡
3. åŠ è½½ `.bin` æ–‡ä»¶
4. è®¾ç½®èµ·å§‹åœ°å€ï¼š
   - å¼•å¯¼ç¨‹åºï¼š0x08000000
   - åº”ç”¨ç¨‹åºï¼š0x08008000
5. ç‚¹å‡» "Program & Verify"

## æ•…éšœæŽ’é™¤

### å¸¸è§ç¼–è¯‘é”™è¯¯

**é”™è¯¯**: `mbed-os.lib not found`
**è§£å†³**: 
```powershell
cd slave_upgraded
mbed deploy
```

**é”™è¯¯**: `Compiler not found`
**è§£å†³**: ç¡®è®¤ ARM Compiler 6 å·²æ­£ç¡®å®‰è£…å¹¶æ·»åŠ åˆ° PATH

**é”™è¯¯**: `Target not supported`
**è§£å†³**: ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„ç›®æ ‡æ¿ `NUCLEO_F446RE`

### ç¼–è¯‘ä¼˜åŒ–å»ºè®®

1. **æ¸…ç†æž„å»º**ï¼š
   ```powershell
   mbed compile --clean
   ```

2. **è¯¦ç»†è¾“å‡º**ï¼š
   ```powershell
   mbed compile -v
   ```

3. **å¹¶è¡Œç¼–è¯‘**ï¼š
   ```powershell
   mbed compile -j 4
   ```

## è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»ºæ‰¹å¤„ç†è„šæœ¬è‡ªåŠ¨ç¼–è¯‘ä¸¤ä¸ªå›ºä»¶ï¼š

```powershell
# build_all.ps1
Write-Host "å¼€å§‹ç¼–è¯‘ Fan Club MkIV å›ºä»¶..."

# ç¼–è¯‘ä»Žæœºå›ºä»¶
Write-Host "ç¼–è¯‘ä»Žæœºå›ºä»¶..."
cd slave_upgraded
mbed compile -t ARMC6 -m NUCLEO_F446RE
if ($LASTEXITCODE -eq 0) {
    Write-Host "âœ… ä»Žæœºå›ºä»¶ç¼–è¯‘æˆåŠŸ"
} else {
    Write-Host "âŒ ä»Žæœºå›ºä»¶ç¼–è¯‘å¤±è´¥"
    exit 1
}

# ç¼–è¯‘å¼•å¯¼ç¨‹åºå›ºä»¶
Write-Host "ç¼–è¯‘å¼•å¯¼ç¨‹åºå›ºä»¶..."
cd ..\slave_bootloader_upgraded
mbed compile -t ARMC6 -m NUCLEO_F446RE
if ($LASTEXITCODE -eq 0) {
    Write-Host "âœ… å¼•å¯¼ç¨‹åºå›ºä»¶ç¼–è¯‘æˆåŠŸ"
} else {
    Write-Host "âŒ å¼•å¯¼ç¨‹åºå›ºä»¶ç¼–è¯‘å¤±è´¥"
    exit 1
}

Write-Host "ðŸŽ‰ æ‰€æœ‰å›ºä»¶ç¼–è¯‘å®Œæˆï¼"

# å¤åˆ¶åˆ°å‘å¸ƒç›®å½•
New-Item -ItemType Directory -Force -Path "..\master\FC_MkIV_binaries"
Copy-Item "BUILD\NUCLEO_F446RE\ARMC6\*.bin" "..\master\FC_MkIV_binaries\"
Write-Host "ðŸ“¦ å›ºä»¶å·²å¤åˆ¶åˆ°å‘å¸ƒç›®å½•"
```

## æ€§èƒ½æŒ‡æ ‡

### ç¼–è¯‘æ—¶é—´
- **ä»Žæœºå›ºä»¶**: çº¦ 2-5 åˆ†é’Ÿ
- **å¼•å¯¼ç¨‹åºå›ºä»¶**: çº¦ 1-3 åˆ†é’Ÿ
- **æ€»è®¡**: çº¦ 3-8 åˆ†é’Ÿ

### èµ„æºä½¿ç”¨
- **Flash ä½¿ç”¨çŽ‡**: çº¦ 40-60%
- **RAM ä½¿ç”¨çŽ‡**: çº¦ 30-50%
- **ç¼–è¯‘å†…å­˜éœ€æ±‚**: è‡³å°‘ 2GB RAM

## æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥ï¼š

1. âœ… ä½¿ç”¨ Mbed Studio æˆ–å‘½ä»¤è¡Œç¼–è¯‘å›ºä»¶
2. âœ… ç”Ÿæˆå¯éƒ¨ç½²çš„ `.bin` æ–‡ä»¶
3. âœ… éªŒè¯ç¼–è¯‘ç»“æžœçš„å®Œæ•´æ€§
4. âœ… å°†å›ºä»¶éƒ¨ç½²åˆ°ç¡¬ä»¶
5. âœ… è§£å†³å¸¸è§ç¼–è¯‘é—®é¢˜

**ä¸‹ä¸€æ­¥**: è¿è¡Œ `master/main.py` å¼€å§‹ä½¿ç”¨ Fan Club MkIV ç³»ç»Ÿï¼

---

*æœ€åŽæ›´æ–°: 2025å¹´1æœˆ*
*é¡¹ç›®çŠ¶æ€: ç”Ÿäº§å°±ç»ª âœ…*